# نظام مكتبة الصور - مدرسة الشمامسة

## نظرة عامة

نظام مكتبة الصور هو نظام متكامل لإدارة وعرض الصور في مدرسة الشمامسة. يتيح النظام للخدام رفع وإدارة الصور، بينما يمكن للطلاب والمستخدمين العاديين تصفح وتحميل الصور.

## المميزات

### للمستخدمين غير المسجلين
- عرض رسالة تطلب تسجيل الدخول للوصول إلى مكتبة الصور

### للمستخدمين المسجلين (طلاب وخدام)
- تصفح جميع المكتبات النشطة
- عرض الصور في Lightbox
- تحميل الصور
- البحث في المكتبات

### للخدام فقط
- إنشاء مكتبات صور جديدة
- رفع صور متعددة في نفس الوقت
- إدارة المكتبات (تعديل، حذف)
- حذف صور من المكتبات
- إنشاء صور مصغرة تلقائياً

## البنية التقنية

### الموديلات (Models)
1. **PhotoGallery** - إدارة المكتبات
   - العلاقات مع المستخدمين والصور
   - إدارة حالة المكتبة (نشطة/غير نشطة)

2. **GalleryPhoto** - إدارة الصور الفردية
   - معلومات الملف (الحجم، النوع، إلخ)
   - إنشاء صور مصغرة
   - تنسيق حجم الملف

### الكنترولر (Controller)
**PhotoGalleryController** يحتوي على:
- عرض المكتبات والصور
- إنشاء وتعديل المكتبات
- رفع وحذف الصور
- تحميل الصور
- إدارة الصلاحيات

### الفيووز (Views)
1. **index.blade.php** - قائمة المكتبات
2. **show.blade.php** - عرض مكتبة معينة
3. **create.blade.php** - إنشاء مكتبة جديدة
4. **edit.blade.php** - تعديل المكتبة

## التثبيت والإعداد

### 1. تشغيل المايجريشنز
```bash
php artisan migrate
```

### 2. إنشاء رابط رمزي للتخزين
```bash
php artisan storage:link
```

### 3. تثبيت حزمة معالجة الصور
```bash
composer require intervention/image
```

### 4. تشغيل Seeder (اختياري)
```bash
php artisan db:seed --class=PhotoGallerySeeder
```

## الراوتس (Routes)

### راوتس عامة
- `GET /photo-gallery` - قائمة المكتبات
- `GET /photo-gallery/{id}` - عرض مكتبة معينة

### راوتس تتطلب تسجيل دخول
- `GET /photo-gallery/create` - إنشاء مكتبة جديدة
- `POST /photo-gallery` - حفظ مكتبة جديدة
- `GET /photo-gallery/{id}/edit` - تعديل المكتبة
- `PUT /photo-gallery/{id}` - تحديث المكتبة
- `DELETE /photo-gallery/{id}` - حذف المكتبة
- `POST /photo-gallery/{id}/upload-photos` - رفع صور جديدة
- `GET /photo-gallery/{galleryId}/photos/{photoId}/delete` - حذف صورة
- `GET /photo-gallery/{galleryId}/photos/{photoId}/download` - تحميل صورة

## إدارة الصلاحيات

### نظام الأدوار
- **غير مسجل**: لا يمكن الوصول للمكتبة
- **طالب/مخدوم**: يمكن التصفح والتحميل فقط
- **خادم**: يمكن إنشاء وإدارة المكتبات والصور

### التحقق من الصلاحيات
```php
// في الكنترولر
if (!Auth::user()->isServant()) {
    abort(403, 'غير مصرح لك بإنشاء مكتبات صور');
}

// في الفيو
@if(auth()->user()->isServant())
    // أزرار الإدارة
@endif
```

## معالجة الصور

### إنشاء الصور المصغرة
- يتم إنشاء صور مصغرة تلقائياً عند رفع الصور
- الحجم: 300x300 بكسل مع الحفاظ على النسبة
- يتم حفظها في مجلد `thumbnails` داخل مجلد المكتبة

### أنواع الملفات المدعومة
- JPEG, PNG, JPG, GIF
- الحد الأقصى: 10MB لكل صورة

### تنظيم الملفات
```
storage/app/public/galleries/
├── conference-2025/
│   ├── image1.jpg
│   ├── image2.png
│   └── thumbnails/
│       ├── image1.jpg
│       └── image2.png
└── church-trips/
    └── ...
```

## الواجهة الأمامية

### التصميم
- تصميم عصري وresponsive
- استخدام Tailwind CSS
- دعم اللغة العربية (RTL)
- Lightbox لعرض الصور

### المميزات التفاعلية
- Drag & Drop لرفع الصور
- Preview للصور المختارة
- تأثيرات hover
- رسائل تأكيد للحذف

## الأمان

### التحقق من الملفات
- التحقق من نوع الملف
- التحقق من حجم الملف
- تنظيف أسماء الملفات

### حماية من الهجمات
- CSRF protection
- التحقق من الصلاحيات
- تنظيف المدخلات

## الصيانة

### تنظيف الملفات المحذوفة
```php
// في الكنترولر عند حذف صورة
Storage::delete($photo->file_path);
Storage::delete($thumbnailPath);
```

### مراقبة المساحة
- مراقبة حجم الملفات المرفوعة
- تنظيف الملفات غير المستخدمة

## التطوير المستقبلي

### ميزات مقترحة
- البحث في الصور
- تصنيف الصور
- مشاركة الصور
- إضافة وصف للصور
- دعم الفيديو
- نظام التعليقات

### تحسينات تقنية
- تحسين أداء الصور
- ضغط الصور تلقائياً
- CDN للصور
- نظام النسخ الاحتياطي

## الدعم

لأي استفسارات أو مشاكل، يرجى التواصل مع فريق التطوير. 